{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-12 col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title mb-3">Filtros</h5>

        <div class="mb-2">
          <label class="form-label">Año (opcional)</label>
          <select id="anioEleccion" class="form-select">
            <option value="">—</option>
            {% for a in anios %}
            <option value="{{a}}">{{a}}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-2">
          <label class="form-label">Tipo de recuento</label>
          <select id="tipoRecuento" class="form-select">
            {% for t in tipos_recuento %}
            <option value="{{t.value}}">{{t.label}}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-2">
          <label class="form-label">Tipo de elección (opcional)</label>
          <select id="tipoEleccion" class="form-select">
            <option value="">—</option>
            {% for t in tipos_eleccion %}
            <option value="{{t.value}}">{{t.label}}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-2">
          <label class="form-label">Categoría (cargo) <span class="text-danger">*</span></label>
          <select id="categoriaId" class="form-select" required>
            <option value="">— Elegí —</option>
            {% for c in categorias %}
              <option value="{{c.value}}">{{c.label}} ({{c.value}})</option>
            {% endfor %}
          </select>
          <div class="form-text">IDs oficiales de cargo.</div>
        </div>

        <hr class="my-3">

        <details>
          <summary class="mb-2">Filtros avanzados (opcionales)</summary>

          <div class="mt-2">
            <label class="form-label">Distrito</label>
            <select id="distritoId" class="form-select">
              <option value="">—</option>
              {% for d in distritos %}
                <option value="{{d.value}}">{{d.label}} ({{d.value}})</option>
              {% endfor %}
            </select>
          </div>

          <div class="mt-2">
            <label class="form-label">Sección Provincial ID</label>
            <input id="seccionProvincialId" class="form-control">
          </div>
          <div class="mt-2">
            <label class="form-label">Sección / Depto / Comuna ID</label>
            <input id="seccionId" class="form-control">
          </div>
          <div class="mt-2">
            <label class="form-label">Circuito ID</label>
            <input id="circuitoId" class="form-control">
          </div>
          <div class="mt-2">
            <label class="form-label">Mesa ID</label>
            <input id="mesaId" class="form-control">
          </div>
        </details>

        <div class="d-grid mt-3">
          <button id="btnConsultar" class="btn btn-primary">Consultar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Resultados</h5>
          <div class="btn-group">
            <a id="btnExcel" class="btn btn-outline-success disabled" role="button">Exportar Excel</a>
            <a id="btnPDF" class="btn btn-outline-danger disabled" role="button">Exportar PDF</a>
          </div>
        </div>

        <div id="meta" class="small text-muted mb-2"></div>

        <!-- Resumen de totalización -->
        <div id="resumenWrap" class="card shadow-sm mt-3 d-none">
          <div class="card-body">
            <h6 class="card-title mb-2">Resumen del escrutinio</h6>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <strong>Fecha totalización:</strong>
                <span id="resumenFecha"></span>
              </li>
              <li class="list-group-item">
                <strong>Electores habilitados:</strong>
                <span id="resumenElectores"></span>
              </li>
              <li class="list-group-item">
                <strong>Votantes:</strong>
                <span id="resumenVotantes"></span>
              </li>
              <li class="list-group-item">
                <strong>Mesas esperadas:</strong>
                <span id="resumenMesasEsperadas"></span>
              </li>
              <li class="list-group-item">
                <strong>Mesas totalizadas:</strong>
                <span id="resumenMesasTotalizadas"></span>
                (<span id="resumenMesasPorcentaje"></span>%)
              </li>
              <li class="list-group-item">
                <strong>Participación:</strong>
                <span id="resumenParticipacion"></span> %
              </li>
            </ul>
          </div>
        </div>

        <div class="table-responsive mt-3">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>Agrupación</th>
                <th class="text-end">Votos</th>
                <th class="text-end">%</th>
              </tr>
            </thead>
            <tbody id="tbodyPositivos">
              <tr><td colspan="3" class="text-muted">Sin datos</td></tr>
            </tbody>
          </table>
        </div>

        <div id="otrosWrap" class="mt-3 d-none">
          <h6>Otros</h6>
          <pre id="otros" class="bg-light p-2 rounded small mb-0"></pre>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
